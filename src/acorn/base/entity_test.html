<!DOCTYPE html>
<html>
<head>
<title>acorn.base.Entity Unit Tests</title>
<script src="../../../libs/closure-library/closure/goog/base.js"></script>
<script src="../../deps.js"></script>
<script>
  goog.require('acorn.base.Entity');
  goog.require('goog.testing.jsunit');
  goog.require('goog.testing.StrictMock');
</script>
</head>
<body>
<script>

var mockBehavior, mockComponent;

function setUpPage() {
  mockBehavior = new goog.testing.StrictMock(new acorn.base.Behavior());
  mockComponent = new goog.testing.StrictMock(new acorn.base.Component());
}

function setUp() {
  mockBehavior.$reset();
  mockComponent.$reset();
}

function testSupportsBehaviorReturnsTrue() {
  mockBehavior.getRequiredComponents().$returns([mockComponent]);
  mockComponent.getComponentId().$returns(1).$times(2);

  mockBehavior.$replay();
  mockComponent.$replay();

  var entity = new acorn.base.Entity();
  entity.attachComponent(mockComponent);
  assertTrue(entity.supportsBehavior(mockBehavior));

  mockBehavior.$verify();
  mockComponent.$verify();
}

function testSupportsBehaviorReturnsFalse() {
  mockBehavior.getRequiredComponents().$returns([mockComponent,
      new goog.testing.StrictMock(new acorn.base.Component())]);
  mockComponent.getComponentId().$returns(1).$times(2);

  mockBehavior.$replay();
  mockComponent.$replay();

  var entity = new acorn.base.Entity();
  entity.attachComponent(mockComponent);
  assertFalse(entity.supportsBehavior(mockBehavior));

  mockBehavior.$verify();
  mockComponent.$verify();
}

function testSupportsBehaviorHandlesUndefined() {
  var entity = new acorn.base.Entity();
  assertFalse(entity.supportsBehavior(undefined));
}

function testEnableBehavior() {
  var otherMockComponent = new goog.testing.StrictMock(
      new acorn.base.Component());
  mockComponent.getComponentId().$returns(1).$times(2);
  otherMockComponent.getComponentId().$returns(2).$times(2);
  mockBehavior.getRequiredComponents().$returns(
      [mockComponent, otherMockComponent]);
  mockBehavior.getBehaviorId().$returns(1);

  mockComponent.$replay();
  otherMockComponent.$replay();
  mockBehavior.$replay();

  var entity = new acorn.base.Entity();
  entity.attachComponent(mockComponent);
  entity.attachComponent(otherMockComponent);
  entity.enableBehavior(mockBehavior);

  mockComponent.$verify();
  otherMockComponent.$verify();
  mockBehavior.$verify();
}

function testAttachComponent() {
  mockComponent.getComponentId().$returns(1).$times(3);

  mockComponent.$replay();

  var entity = new acorn.base.Entity();
  assertFalse(entity.hasComponent(mockComponent));
  entity.attachComponent(mockComponent);
  assertTrue(entity.hasComponent(mockComponent));

  mockComponent.$verify();
}

function testAttachComponentReturnsThis() {
  mockComponent.getComponentId().$returns(1);

  mockComponent.$replay();

  var entity = new acorn.base.Entity();
  var ret = entity.attachComponent(mockComponent);
  assertEquals(entity, ret);

  mockComponent.$verify();
}

function testAttachComponents() {
  var otherMockComponent = new goog.testing.StrictMock(
      new acorn.base.Component());
  mockComponent.getComponentId().$returns(1).$times(2);
  otherMockComponent.getComponentId().$returns(2).$times(2);

  mockComponent.$replay();
  otherMockComponent.$replay();

  var entity = new acorn.base.Entity();
  entity.attachComponents([mockComponent, otherMockComponent]);
  assertTrue(entity.hasComponent(mockComponent));
  assertTrue(entity.hasComponent(otherMockComponent));

  mockComponent.$verify();
  otherMockComponent.$verify();
}

function testAttachComponentsEmptyList() {
  var entity = new acorn.base.Entity();
  entity.attachComponents([]);
}

function testAttachComponentsReturnsThis() {
  mockComponent.getComponentId().$returns(1);

  mockComponent.$replay();

  var entity = new acorn.base.Entity();
  var ret = entity.attachComponents([mockComponent]);
  assertEquals(entity, ret);

  mockComponent.$verify();
}

function testGetComponent() { 
  mockComponent.getComponentId().$returns(1).$times(2);

  mockComponent.$replay();

  var entity = new acorn.base.Entity();
  var ret = entity.attachComponent(mockComponent);
  assertEquals(mockComponent, entity.getComponent(mockComponent));

  mockComponent.$verify();
}

function testGetComponentReturnsNull() {
  mockComponent.getComponentId().$returns(1);

  mockComponent.$replay();

  var entity = new acorn.base.Entity();
  assertEquals(null, entity.getComponent(mockComponent));

  mockComponent.$verify();
}
</script>
</body>
</html>
